<html>

<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<title>Graph2d | Basic Example</title>

	<script type="text/javascript" src="../Chart.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
	<script type="text/javascript" src="../data_tables.js"></script>






	<!-- <script src="../vis-timeline-graph2d.min.js"></script>
	<script src="../vis-network.min.js"></script> -->
	<style type="text/css">
		body,
		html {
			font-family: sans-serif;
		}
	</style>

<body>
	hola
	<div id="DialogQualityLogicalConsistency">
		<form>
			<h3> Logical consistency</h3>
			<div id="DialogQualityLogicalConsistency_table_div">
				<table style="border:2px solid black; border-collapse:collapse;">
					<thead>
						<th id="DialogQualityLogicalConsistency_table_0"
							style="border:1px solid black; padding:6px; border-right:3px solid black; text-align:center;">
						</th>
						<th id="DialogQualityLogicalConsistency_table_1"
							style="border:1px solid black; padding:6px; text-align:center;"></th>
					</thead>
					<tbody>
						<tr>
							<td
								style="border:1px solid black; padding:6px; border-right:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_select_targetOrReference_0">
									<option value="target">Target</option>
									<option value="reference">Reference</option>
								</select>
							</td>
							<td style="border:1px solid black; padding:6px; text-align:center;">
								<select id="DialogQualityLogicalConsistency_select_targetOrReference_1">
									<option value="target">Target</option>
									<option value="reference" selected>Reference</option>
								</select>
							</td>
						</tr>
						<tr>
							<td style="border-top:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center; padding-bottom:0px;">
								Column 1
							</td>
							<td style="border-top:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center; padding-bottom:0px;">
								Column 1
							</td>
						</tr>
						<tr>
							<td style="border-bottom:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute1_0"
									style="margin:0 5px 0 5px;"></select>
							</td>
							<td style="border-bottom:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute1_1"
									style="margin:0 5px 0 5px;"></select>
							</td>
						</tr>
						<tr>
							<td style="border-top:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center; padding-bottom:0px;">
								Column 2
							</td>
							<td style="border-top:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center; padding-bottom:0px;">
								Column 2
							</td>
						</tr>
						<tr>
							<td style="border-bottom:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute2_0"
									style="margin:0 5px 0 5px;"></select>
							</td>
							<td style="border-bottom:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute2_1"
									style="margin:0 5px 0 5px;"></select>
							</td>
						</tr>
						<tr>
							<td style="border-top:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center; padding-bottom:0px;">
								Column 3
							</td>
							<td style="border-top:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center; padding-bottom:0px;">
								Column 3
							</td>
						</tr>
						<tr>
							<td style="border-bottom:1px solid black; border-left:1px solid black; padding:6px;
									border-right:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute3_0"
									style="margin:0 5px 0 5px;"></select>
							</td>
							<td style="border-bottom:1px solid black; border-right:1px solid black; padding:6px;
									border-left:3px solid black; text-align:center;">
								<select id="DialogQualityLogicalConsistency_selectAttribute3_1"
									style="margin:0 5px 0 5px;"></select>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div style="margin-top: 20px;">

				<label><input type="checkbox" value="logicalConsistency_calculateRate"
						id="dataQuality_logicalConsistency_calculate" name="dataQuality_logicalConsistency"
						checked>Calculate the global LogicalConsistency rate (%)</label><br>
				<label><input type="checkbox" value="logicalConsistency_flagBadRecords"
						id="dataQuality_logicalConsistency_flag" name="dataQuality_logicalConsistency">Flag the bad
					records (true/false)</label><br>
				<label><input type="checkbox" value="logicalConsistency_filterBadRecords"
						id="dataQuality_logicalConsistency_filter" name="dataQuality_logicalConsistency">Filter the
					table to keep only valid records</label>
			</div>
			<div class="center">
				<button value="ok" onClick="okButtonDataQualityDialogQualityLogicalConsistency(event)"
					formmethod="dialog">Ok</button> <button value="cancel" formmethod="dialog">Cancel</button>
			</div>
			<input type="hidden" id="DialogQualityLogicalConsistencyNodeId"></input>
		</form>
	</div>

	<script>

	</script>
</body>
<script>
	function okButtonDataQualityThematicQuality(event) {
		var node = getNodeDialog("DialogQualityThematicQuality");
		var thematicAccuracy = (document.getElementById("ThematicQuality_checkbox_ThematicAccuracy").checked) ? true : false;
		var thematicValidity = (document.getElementById("ThematicQuality_checkbox_ThematicValidity").checked) ? true : false;
		var thematicAttribute = document.getElementById("thematicQuality_select_columnToEvaluate");
		var thematicAttributeSelected = thematicAttribute.options[thematicAttribute.selectedIndex].value;
		var nodeIdToEvaluate = document.getElementById("ThematicQuality_select_metadata");
		var nodeIdToEvaluateSelected = nodeIdToEvaluate.options[nodeIdToEvaluate.selectedIndex].value;
		var metadata = (networkNodes.get(nodeIdToEvaluateSelected).STAmetadata) ? networkNodes.get(nodeIdToEvaluateSelected).STAmetadata : {};
		var dataToEvaluate = networkNodes.get(nodeIdToEvaluateSelected).STAdata;
		var nodeIds = document.getElementById("DialogQualityThematicQuality").getAttribute("data-node-ids");
		nodeIds = nodeIds.split("_");
		var referenceNodeId;
		for (var n = 0; n < nodeIds.length; n++) {
			if (!nodeIds[n] == nodeIdToEvaluateSelected) referenceNodeId = nodeIds[n];
		}

		if (thematicAccuracy) {
			var grouped = false, newColumns = false;
			var inputWayGroup = document.querySelector('input[name="thematicQuality_radio_thematicAccuracy_way"]:checked')
			var inputWayValue = inputWayGroup.value; //accuracyStaDev, alfaNum, number
			if (inputWayValue == "alfaNum" || inputWayValue == "number") {
				var groupingMode = (document.getElementById("thematicQuality_radio_thematicAccuracy_group").checked) ? "grouped" : "all";
				if (groupingMode == "grouped") {
					var groupingSelect = document.getElementById("thematicQuality_select_thematicAccuracy_group");
					grouped = groupingSelect.options[groupingSelect.selectedIndex].value;
					if (document.getElementById("thematicQuality_radio_thematicAccuracy_grouping_groupCheckbox").checked) newColumns = true;
				}
			}


			//accuracyStaDev
			if (inputWayValue == "accuracyStaDev") {
				var uncertantuColumn = document.getElementById("DialogQualityThematicQuality_select_uncertantyColumn");
				var uncertantuColumnValue = uncertantuColumn.options[uncertantuColumn.selectedIndex].value;
				var globalAccuracyValue = accuracyFromUncertaintyThematicQuality(dataToEvaluate, metadata, uncertantuColumnValue);
			}
			//alfaNum
			else if (inputWayValue == "alfaNum") {
				var newColumns = (document.getElementById("thematicQuality_radio_thematicAccuracy_grouping_groupCheckbox").checked) ? true : false;
				var globalAccuracyValue = accuracyFromAlfaNumValuesInThematicQuality(dataToEvaluate, metadata, thematicAttributeSelected, grouped, newColumns)

			} else { //num
				var newColumns = (document.getElementById("thematicQuality_radio_thematicAccuracy_grouping_groupCheckbox").checked) ? true : false;
				var globalAccuracyValue = accuracyFromNumValuesInThematicQuality(dataToEvaluate, metadata, thematicAttributeSelected, grouped, newColumns)

			}
		}
		if (thematicValidity) {
			var thematicValidityWay = (document.getElementById("thematicQuality_radio_thematicValidity_list").checked) ? "list" : "range";
			var flag = (document.getElementById("dataQuality_thematicValidity_flag").checked) ? true : false;
			if (thematicValidityWay == "list") {
				var refenceAttributeSelect = document.getElementById("thematicQuality_select_thematicValidity");
				var referenceAttributeValue = refenceAttributeSelect.options[refenceAttributeSelect.selectedIndex].value;
				var referenceData = networkNodes.get(referenceNodeId).STAdata;
				var thematicValidity = calculateDataQualityThematicValidityWithAList(dataToEvaluate, referenceData, metadata, thematicAttributeSelected, referenceAttributeValue, flag)
			} else {
				var from = document.getElementById("thematicQuality_input_thematicValidity_from")
				var to = document.getElementById("thematicQuality_input_thematicValidity_to")
				var thematicValidity = calculateDataQualityThematicValidityWithRange(dataToEvaluate, from, to, metadata, thematicAttributeSelected, flag)


			}
			if (typeof thematicValidity == "string") valid = false;

		}
		if (valid) {
			node.STAdata = dataToEvaluate;
			node.STAdataAttributes = getDataAttributes(dataToEvaluate);
			networkNodes.update(node);
			updateQueryAndTableArea(node);
			hideNodeDialog("DialogQualityPositionalQuality", event);

			if (thematicAccuracy || thematicValidity) {
				var html = "";
				if (thematicAccuracy) {

					html += `<div> Thematic accuracy <br>
					<table class="tablesmall"><thead><th>Column</th><th>Method</th><th>Value</th></tr></thead>
					<tbody>`

					if (accuracyMethod == "accuracyStaDev") {
						html += `<tr>
						<td>${uncertantuColumnValue} </td>
						<td> Standard deviation </td>
						<td> ${globalAccuracyValue}</td>
						</tr>`
					} else if (accuracyMethod == "alfaNum") {
						html += `<tr>
						<td>${thematicAttributeSelected} </td>`
						if (grouped) html += `<td> Mean of percentatge of mode value </td>`
						else html += `<td> Percentatge of mode value </td>`
						html += `<td> ${globalAccuracyValue} m</td>
						</tr>`
					}
					else {
						html += `<tr>
						<td>${thematicAttributeSelected} </td>`
						if (grouped) html += `<td> Standard deviation of standard deviations across the groups  </td>`
						else html += `<td> Standard deviation </td>`
						html += `<td> ${globalAccuracyValue} m</td>
						</tr>`

					}
					html += "</tbody></table></div>"
				}
				html += "<br>"
				if (thematicValidity) {
					html += `<div> Thematic validity <br>
						<table class="tablesmall"><thead><th>Columns</th><th>Total records</th><th>True records </th><th>Rate</th></tr></thead>
							<tbody><tr>
								<td>${thematicAttributeSelected}</td>
								<td>${dataToEvaluate.length}</td>
								<td>${thematicValidity[0]}</td>
								<td>${thematicValidity[1]}</td>
							</tr>`;
					html += "</tbody></table></div>"
				}
				document.getElementById("dataQualityResult_info").innerHTML = html
			}
			else {
				alert(thematicValidity)
			}
		}
	}
</script>

</html>